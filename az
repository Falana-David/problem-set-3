import os
import asyncio
from azure.identity.aio import DefaultAzureCredential
from azure.search.documents.aio import SearchClient

AZURE_SEARCH_ENDPOINT = os.getenv("AZURE_SEARCH_ENDPOINT")
AZURE_SEARCH_INDEX = os.getenv("AZURE_SEARCH_INDEX")

async def main():
    if not AZURE_SEARCH_ENDPOINT or not AZURE_SEARCH_INDEX:
        raise SystemExit("Set AZURE_SEARCH_ENDPOINT and AZURE_SEARCH_INDEX")

    cred = DefaultAzureCredential()
    client = SearchClient(
        endpoint=AZURE_SEARCH_ENDPOINT,
        index_name=AZURE_SEARCH_INDEX,
        credential=cred,
    )

    try:
        # Simple keyword query (works even if you haven't added vectors yet)
        results = client.search(search_text="test", top=3)

        print("âœ… Connected. Top results:")
        async for r in results:
            # r is a dict-like result
            print("-", r.get("id") or r.get("key") or list(r.keys())[:5])

    finally:
        await client.close()
        await cred.close()

if __name__ == "__main__":
    asyncio.run(main())
